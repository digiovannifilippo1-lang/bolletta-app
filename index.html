<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Preventivo Energia PRO</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
<style>
:root{--bg:#090912;--sf:#11112a;--sf2:#181830;--tx:#f1f5f9;--tx2:#8892a4;--bd:rgba(100,80,255,.18);--wt:#e07020;--opt:#0ea5e9;--ok:#22c55e;--er:#ef4444;}
*{margin:0;padding:0;box-sizing:border-box;}
body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;background:var(--bg);color:var(--tx);padding:16px;min-height:100vh;}
.wrap{max-width:900px;margin:0 auto;}
.hdr{text-align:center;padding:22px 16px 16px;background:var(--sf);border-radius:14px;border:1px solid var(--bd);margin-bottom:14px;}
.logo{font-size:1.8rem;font-weight:900;background:linear-gradient(135deg,#7c3aed,#06b6d4);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;}
.hdr p{color:var(--tx2);margin-top:4px;font-size:.88rem;}
.indici{display:flex;flex-wrap:wrap;gap:12px;align-items:center;background:var(--sf);border-radius:11px;padding:10px 15px;border:1px solid var(--bd);margin-bottom:14px;font-size:.82rem;}
.ic{display:flex;align-items:center;gap:5px;}
.ic b{color:#a78bfa;}
.ic-tag{font-size:.68rem;background:rgba(120,80,255,.16);border-radius:4px;padding:1px 6px;color:#c4b5fd;}
.ic-note{margin-left:auto;font-size:.68rem;color:var(--tx2);font-style:italic;}
.tabs{display:flex;background:var(--sf);border-radius:11px;padding:3px;border:1px solid var(--bd);margin-bottom:14px;}
.tb{flex:1;padding:9px;background:none;border:none;color:var(--tx2);cursor:pointer;font-size:.95rem;font-weight:600;border-radius:9px;transition:all .2s;}
.tb.on{background:linear-gradient(135deg,#7c3aed,#4f46e5);color:#fff;}
.card{background:var(--sf);border-radius:12px;padding:18px;border:1px solid var(--bd);margin-bottom:13px;}
.ctit{font-size:.95rem;font-weight:700;color:#a78bfa;margin-bottom:12px;display:flex;align-items:center;gap:7px;}
.dropz{border:2px dashed rgba(120,80,255,.32);border-radius:10px;padding:28px 16px;text-align:center;cursor:pointer;transition:all .25s;background:rgba(120,80,255,.03);}
.dropz:hover,.dropz.over{border-color:#7c3aed;background:rgba(120,80,255,.08);}
.dropz .ico{font-size:2rem;margin-bottom:6px;}
.dropz h3{color:var(--tx);margin-bottom:4px;font-size:.95rem;}
.dropz p{color:var(--tx2);font-size:.78rem;}
input[type=file]{display:none;}
.stbar{display:none;flex-direction:row;align-items:center;gap:10px;margin-top:10px;background:rgba(120,80,255,.09);border-radius:7px;padding:8px 12px;font-size:.85rem;}
.spin{width:14px;height:14px;border:2.5px solid rgba(120,80,255,.28);border-top:2.5px solid #7c3aed;border-radius:50%;animation:spin 1s linear infinite;flex-shrink:0;}
@keyframes spin{to{transform:rotate(360deg)}}
.ops{display:none;margin-bottom:13px;}
.ops-t{color:var(--tx2);font-size:.84rem;margin-bottom:8px;text-align:center;}
.op-btns{display:flex;gap:10px;}
.ob{flex:1;padding:13px 8px 10px;border-radius:12px;border:2px solid transparent;cursor:pointer;transition:all .2s;background:var(--sf2);text-align:center;display:flex;flex-direction:column;align-items:center;gap:4px;}
.ob:hover{transform:translateY(-2px);}
.ob .nm{font-size:.9rem;font-weight:700;color:var(--tx2);}
.ob .sb{font-size:.68rem;color:var(--tx2);line-height:1.5;}
.ob.wt{border-color:rgba(224,112,32,.2);}
.ob.wt.sel,.ob.wt:hover{background:rgba(224,112,32,.1);border-color:var(--wt);}
.ob.wt.sel .nm,.ob.wt:hover .nm{color:#fdba74;}
.ob.opt{border-color:rgba(14,165,233,.2);}
.ob.opt.sel,.ob.opt:hover{background:rgba(14,165,233,.1);border-color:var(--opt);}
.ob.opt.sel .nm,.ob.opt:hover .nm{color:#7dd3fc;}
.wttog{display:none;background:rgba(224,112,32,.06);border:1px solid rgba(224,112,32,.25);border-radius:10px;padding:12px 14px;margin-bottom:13px;}
.wttog-t{font-size:.87rem;font-weight:600;color:#fdba74;margin-bottom:9px;}
.wt-bs{display:flex;gap:9px;}
.wtsb{flex:1;padding:9px 7px;border-radius:8px;border:2px solid transparent;cursor:pointer;font-size:.84rem;font-weight:700;transition:all .18s;background:var(--sf2);color:var(--tx2);text-align:center;}
.wtsb small{font-size:.67rem;color:var(--tx2);display:block;margin-top:2px;}
.wtsb.y.sel,.wtsb.y:hover{background:rgba(224,112,32,.16);border-color:var(--wt);color:#fdba74;}
.wtsb.n.sel,.wtsb.n:hover{background:rgba(148,163,184,.08);border-color:#94a3b8;color:var(--tx);}
.msg{border-radius:7px;padding:9px 12px;margin-bottom:12px;display:none;font-weight:500;font-size:.87rem;}
.msg.er{background:rgba(239,68,68,.08);border:1.5px solid var(--er);color:var(--er);}
.msg.ok{background:rgba(34,197,94,.08);border:1.5px solid var(--ok);color:var(--ok);}
.res{display:none;}
.hero{border-radius:12px;padding:22px 16px;text-align:center;margin-bottom:12px;border:2px solid;}
.hero.sav{background:linear-gradient(135deg,rgba(34,197,94,.08),rgba(34,197,94,.01));border-color:rgba(34,197,94,.26);}
.hero.los{background:linear-gradient(135deg,rgba(239,68,68,.08),rgba(239,68,68,.01));border-color:rgba(239,68,68,.24);}
.h-tag{font-size:.68rem;text-transform:uppercase;letter-spacing:1.2px;color:var(--tx2);margin-bottom:3px;}
.h-big{font-size:2.7rem;font-weight:900;line-height:1.;}
.h-big.g{color:var(--ok);}
.h-big.r{color:var(--er);}
.h-sub{font-size:.79rem;color:var(--tx2);margin-top:5px;}
.h-sub strong{color:var(--tx);}
.pill{display:inline-block;padding:3px 14px;border-radius:20px;font-weight:800;font-size:.9rem;margin-top:8px;}
.pill.g{background:rgba(34,197,94,.12);color:var(--ok);border:1.5px solid rgba(34,197,94,.22);}
.pill.r{background:rgba(239,68,68,.1);color:var(--er);border:1.5px solid rgba(239,68,68,.22);}
.ng{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-bottom:12px;}
@media(max-width:460px){.ng{grid-template-columns:1fr;}}
.nc{background:var(--sf2);border-radius:10px;padding:14px;border:1.5px solid var(--bd);}
.nc.cr{border-color:rgba(239,68,68,.18);}
.nc.nw{border-color:rgba(224,112,32,.26);}
.nc.no{border-color:rgba(14,165,233,.26);}
.nc-l{font-size:.68rem;text-transform:uppercase;letter-spacing:1px;color:var(--tx2);margin-bottom:2px;}
.nc-o{font-size:.68rem;color:var(--tx2);font-style:italic;margin-bottom:4px;}
.nc-v{font-size:1.5rem;font-weight:800;}
.nc-v.r{color:#f87171;}
.nc-v.or{color:#fdba74;}
.nc-v.bl{color:#7dd3fc;}
.nc-u{font-size:.69rem;color:var(--tx2);margin-top:2px;}
.ch-row{display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-bottom:12px;}
@media(max-width:520px){.ch-row{grid-template-columns:1fr;}}
.chc{background:var(--sf);border:1px solid var(--bd);border-radius:12px;padding:14px;}
.chc h3{color:#a78bfa;margin-bottom:10px;font-size:.83rem;text-align:center;}
.chw{position:relative;max-width:175px;margin:0 auto 8px;}
.chcen{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);text-align:center;pointer-events:none;}
.chcen .cb{font-size:1.35rem;font-weight:900;}
.chcen .cb.g{color:var(--ok);}
.chcen .cb.r{color:var(--er);}
.chcen .cs{font-size:.65rem;color:var(--tx2);}
.chl{display:flex;justify-content:center;gap:10px;font-size:.71rem;color:var(--tx2);flex-wrap:wrap;}
.dot{width:8px;height:8px;border-radius:50%;display:inline-block;margin-right:2px;vertical-align:middle;}
.dstit{font-size:.68rem;text-transform:uppercase;letter-spacing:1px;color:var(--tx2);margin:12px 0 6px;padding-bottom:3px;border-bottom:1px solid rgba(255,255,255,.05);}
.dr{display:flex;justify-content:space-between;padding:4px 0;border-bottom:1px solid rgba(255,255,255,.04);font-size:.81rem;}
.dr:last-child{border-bottom:none;}
.dl{color:var(--tx2);}
.dv{font-weight:600;}
.dv.g{color:var(--ok);}
.dv.r{color:#f87171;}
.dv.or{color:#fdba74;}
.dv.bl{color:#7dd3fc;}
.trow{border-radius:7px;padding:6px 10px;margin-top:5px;display:flex;justify-content:space-between;font-weight:700;font-size:.87rem;}
.trow.c{background:rgba(239,68,68,.06);}
.trow.w{background:rgba(224,112,32,.08);}
.trow.o{background:rgba(14,165,233,.08);}
.qfb{background:rgba(120,80,255,.05);border:1px solid rgba(120,80,255,.18);border-radius:9px;padding:11px 14px;margin-bottom:12px;}
.qfb-t{font-size:.69rem;text-transform:uppercase;letter-spacing:1px;color:#a78bfa;margin-bottom:7px;}
.oi{border-radius:8px;padding:10px 13px;margin-bottom:12px;font-size:.79rem;}
.oi.w{background:rgba(224,112,32,.05);border:1px solid rgba(224,112,32,.18);}
.oi.o{background:rgba(14,165,233,.05);border:1px solid rgba(14,165,233,.18);}
.oi-t{font-weight:700;margin-bottom:5px;font-size:.88rem;}
.oi-r{display:flex;gap:11px;flex-wrap:wrap;}
.oi-i{color:var(--tx2);}
.oi-i b.or{color:#fdba74;}
.oi-i b.bl{color:#7dd3fc;}
.chips{display:flex;flex-wrap:wrap;gap:7px;margin-bottom:11px;}
.chip{background:rgba(120,80,255,.08);border:1px solid var(--bd);border-radius:6px;padding:4px 10px;font-size:.75rem;}
.chip b{color:#a78bfa;display:block;font-size:.88rem;}
.br{color:var(--ok);font-size:.66rem;margin-left:4px;}
.bs{color:#f59e0b;font-size:.66rem;margin-left:4px;}
</style>
</head>
<body>
<div class="wrap">
  <div class="hdr">
    <div class="logo">‚ö° Preventivo Energia PRO</div>
    <p>Carica la bolletta PDF ‚Äî confronto automatico WindTre / Optima</p>
  </div>

  <div class="indici">
    <div class="ic">üí° PUN GME: <b id="pV">0,13266</b> ‚Ç¨/kWh <span class="ic-tag" id="pM">Gen 2026</span></div>
    <div class="ic">üî• PSV: <b id="sV">0,40423</b> ‚Ç¨/Smc <span class="ic-tag" id="sM">Gen 2026</span></div>
    <div class="ic-note">Media mensile GME ¬∑ aggiornata mensilmente</div>
  </div>

  <div class="msg er" id="mEr"></div>
  <div class="msg ok" id="mOk"></div>

  <div class="tabs">
    <button class="tb on" onclick="sTab('l',event)">üí° LUCE</button>
    <button class="tb"    onclick="sTab('g',event)">üî• GAS</button>
  </div>

  <div id="TL">
    <div class="card">
      <div class="ctit">üìÑ Bolletta LUCE (PDF)</div>
      <div class="dropz" id="DL" ondrop="onDrop(event,'l')" ondragover="onOv(event,'l')" ondragleave="onLv(event,'l')" onclick="document.getElementById('FL').click()">
        <div class="ico">üìã</div>
        <h3>Trascina PDF o clicca per selezionare</h3>
        <p>Qualsiasi operatore italiano ¬∑ Max 10 MB</p>
      </div>
      <input type="file" id="FL" accept=".pdf" onchange="onFile(event,'l')">
      <div class="stbar" id="SBL"><div class="spin"></div><span id="STL">Lettura...</span></div>
    </div>
    <div class="ops" id="OPL">
      <div class="ops-t">Scegli operatore per il preventivo:</div>
      <div class="op-btns">
        <div class="ob wt" id="BWL" onclick="selOp('l','wt')"><span style="font-size:1.3rem">üåÄ</span><span class="nm">WindTre</span><span class="sb">PUN+0,0278 ‚Ç¨/kWh<br>Canone 90‚Äì156 ‚Ç¨/anno</span></div>
        <div class="ob opt" id="BOL" onclick="selOp('l','opt')"><span style="font-size:1.3rem">üîµ</span><span class="nm">Optima</span><span class="sb">PUN+0,0396 ‚Ç¨/kWh<br>Canone 154,80 ‚Ç¨/anno</span></div>
      </div>
    </div>
    <div class="wttog" id="WTL">
      <div class="wttog-t">üåÄ Il cliente √® gi√† cliente WindTre?</div>
      <div class="wt-bs">
        <div class="wtsb y" id="WYL" onclick="selWt('l',true)">‚úÖ S√¨, cliente WindTre<small>Canone 90 ‚Ç¨/anno</small></div>
        <div class="wtsb n" id="WNL" onclick="selWt('l',false)">‚ùå No, non √® cliente<small>Canone 156 ‚Ç¨/anno</small></div>
      </div>
    </div>
    <div class="res" id="RL"></div>
  </div>

  <div id="TG" style="display:none">
    <div class="card">
      <div class="ctit">üìÑ Bolletta GAS (PDF)</div>
      <div class="dropz" id="DG" ondrop="onDrop(event,'g')" ondragover="onOv(event,'g')" ondragleave="onLv(event,'g')" onclick="document.getElementById('FG').click()">
        <div class="ico">üìã</div>
        <h3>Trascina PDF o clicca per selezionare</h3>
        <p>Qualsiasi operatore italiano ¬∑ Max 10 MB</p>
      </div>
      <input type="file" id="FG" accept=".pdf" onchange="onFile(event,'g')">
      <div class="stbar" id="SBG"><div class="spin"></div><span id="STG">Lettura...</span></div>
    </div>
    <div class="ops" id="OPG">
      <div class="ops-t">Scegli operatore per il preventivo:</div>
      <div class="op-btns">
        <div class="ob wt" id="BWG" onclick="selOp('g','wt')"><span style="font-size:1.3rem">üåÄ</span><span class="nm">WindTre</span><span class="sb">PSV+0,0965 ‚Ç¨/Smc<br>Canone 90‚Äì156 ‚Ç¨/anno</span></div>
        <div class="ob opt" id="BOG" onclick="selOp('g','opt')"><span style="font-size:1.3rem">üîµ</span><span class="nm">Optima</span><span class="sb">PSV+0,12 ‚Ç¨/Smc<br>Canone 162 ‚Ç¨/anno</span></div>
      </div>
    </div>
    <div class="wttog" id="WTG">
      <div class="wttog-t">üåÄ Il cliente √® gi√† cliente WindTre?</div>
      <div class="wt-bs">
        <div class="wtsb y" id="WYG" onclick="selWt('g',true)">‚úÖ S√¨, cliente WindTre<small>Canone 90 ‚Ç¨/anno</small></div>
        <div class="wtsb n" id="WNG" onclick="selWt('g',false)">‚ùå No, non √® cliente<small>Canone 156 ‚Ç¨/anno</small></div>
      </div>
    </div>
    <div class="res" id="RG"></div>
  </div>
</div>

<script>
pdfjsLib.GlobalWorkerOptions.workerSrc='https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';

const IND={pun:0.132660,psv:0.404227,mese:'Gen 2026'};
(async()=>{
  try{
    const r=await fetch('/api/indici',{signal:AbortSignal.timeout(3000)});
    if(r.ok){
      const d=await r.json();
      if(d.pun)IND.pun=d.pun;
      if(d.psv)IND.psv=d.psv;
      if(d.mese)IND.mese=d.mese;
    }
  }catch(e){}
  document.getElementById('pV').textContent=IND.pun.toFixed(5);
  document.getElementById('sV').textContent=IND.psv.toFixed(5);
  document.getElementById('pM').textContent=IND.mese;
  document.getElementById('sM').textContent=IND.mese;
})();

const TAR={
  l:{get idx(){return IND.pun;},iva:0.10,wt:{sp:0.0278,vc:0.0154,fWT:90,fNO:156},opt:{sp:0.0396,vc:0.0154,f:154.80}},
  g:{get idx(){return IND.psv;},iva:0.22,wt:{sp:0.0965,vc:0,fWT:90,fNO:156},opt:{sp:0.12,vc:0.11,f:162}}
};
const BD={l:null,g:null};
const SOP={l:null,g:null};
const SWT={l:null,g:null};
const CH={};

function sTab(t,e){
  ['l','g'].forEach(x=>document.getElementById('T'+x.toUpperCase()).style.display='none');
  document.querySelectorAll('.tb').forEach(b=>b.classList.remove('on'));
  document.getElementById('T'+t.toUpperCase()).style.display='block';
  e.target.classList.add('on');
}
const U=t=>t.toUpperCase();
function onOv(e,t){e.preventDefault();document.getElementById('D'+U(t)).classList.add('over');}
function onLv(e,t){e.preventDefault();document.getElementById('D'+U(t)).classList.remove('over');}
function onDrop(e,t){e.preventDefault();onLv(e,t);const f=e.dataTransfer.files[0];if(f&&f.type==='application/pdf')readPDF(f,t);else showEr('Carica un PDF valido.');}
function onFile(e,t){if(e.target.files[0])readPDF(e.target.files[0],t);}

async function analyzeWithAI(rawText, tipo) {
  const resp = await fetch('/api/bolletta-ai?tipo=' + tipo, {
    method: 'POST',
    headers: {'Content-Type':'application/json'},
    body: JSON.stringify({ text: rawText })
  });

  const data = await resp.json();

  if (!resp.ok || !data.success) {
    throw new Error(data.error || 'Errore analisi IA');
  }

  return {
    op: data.operatore || 'Operatore attuale',
    periodo: data.periodo || '',
    mesi: data.mesi || 2,
    consumoPer: data.consumoPeriodo,
    spesaPer: data.spesaPeriodo,
    consumoAnn: data.consumoAnnuo,
    spesaAnn: data.spesaAnnua,
    qfAnn: data.quotaFissaAnnua,
    qfFonte: data.quotaFissaAnnua ? 'reale' : 'stimata'
  };
}

async function readPDF(file,t){
  const sb=document.getElementById('SB'+U(t));
  const st=document.getElementById('ST'+U(t));
  sb.style.display='flex';
  document.getElementById('R'+U(t)).style.display='none';
  document.getElementById('OP'+U(t)).style.display='none';
  document.getElementById('WT'+U(t)).style.display='none';
  resetOb(t);
  st.textContent='Lettura PDF...';
  try{
    if(file.size>10485760){showEr('File troppo grande (max 10 MB)');sb.style.display='none';return;}
    const buf=await file.arrayBuffer();
    const pdf=await pdfjsLib.getDocument({data:buf}).promise;
    st.textContent='Analisi '+pdf.numPages+' pagine...';
    let raw='';
    for(let p=1;p<=pdf.numPages;p++){
      const pg=await pdf.getPage(p);
      const c=await pg.getTextContent();
      raw+=c.items.map(i=>i.str).join(' ')+'\n';
    }
    st.textContent='Analisi IA...';
    const tipo=t==='l'?'luce':'gas';
    const dati=await analyzeWithAI(raw,tipo);
    sb.style.display='none';

    if(!dati.consumoPer || !dati.spesaPer){
      showEr('‚ö†Ô∏è IA: non √® riuscita a trovare consumo o spesa nel periodo.');
      return;
    }

    BD[t]=dati;
    document.getElementById('OP'+U(t)).style.display='block';
    const ua=t==='l'?'kWh':'Smc';
    showOk(
      '‚úÖ '+dati.op+
      (dati.periodo?' ¬∑ Periodo '+dati.periodo:'')+
      ' ¬∑ '+dati.consumoPer.toFixed(0)+' '+ua+
      ' ¬∑ ‚Ç¨ '+dati.spesaPer.toFixed(2)+' nel periodo'+
      (dati.qfAnn?' ¬∑ Canone ‚Ç¨'+dati.qfAnn.toFixed(2)+'/anno':'')+
      ' ‚Äî Scegli operatore'
    );
  }catch(err){
    console.error(err);
    showEr('Errore lettura/analisi PDF: '+err.message);
    sb.style.display='none';
  }
}

function selOp(t,op){
  resetOb(t);
  document.getElementById('B'+op.toUpperCase()[0]+U(t)).classList.add('sel');
  SOP[t]=op;
  document.getElementById('WT'+U(t)).style.display=op==='wt'?'block':'none';
  document.getElementById('R'+U(t)).style.display='none';
  if(op!=='wt'){SWT[t]=null;calcola(t,op);}
}
function resetOb(t){
  ['W','O'].forEach(o=>{const el=document.getElementById('B'+o+U(t));if(el)el.classList.remove('sel');});
  ['Y','N'].forEach(n=>{const el=document.getElementById('W'+n+U(t));if(el)el.classList.remove('sel');});
}
function selWt(t,v){
  SWT[t]=v;
  document.getElementById('WY'+U(t)).classList.toggle('sel',v);
  document.getElementById('WN'+U(t)).classList.toggle('sel',!v);
  calcola(t,'wt');
}

function calcola(t,op){
  const d=BD[t]; if(!d)return;
  const T2=TAR[t];const O=T2[op];
  const ua=t==='l'?'kWh':'Smc';
  const isWt=op==='wt';
  const opN=isWt?'WindTre':'Optima';
  const opC=isWt?'or':'bl';
  const isWtCl=isWt&&SWT[t]===true;
  const fissoAnn=isWt?(isWtCl?O.fWT:O.fNO):O.f;

  const mesi=d.mesi||2;
  const consumoPer=d.consumoPer;
  const spesaPer=d.spesaPer;
  const fattore=12/mesi;

  const pzL=parseFloat(((T2.idx+O.sp+(O.vc||0))*(1+T2.iva)).toFixed(6));

  const costoVarPer=parseFloat((pzL*consumoPer).toFixed(2));
  const costoFissoPer=parseFloat((fissoAnn*(mesi/12)).toFixed(2));
  const costoPer=costoVarPer+costoFissoPer;

  const spesaAnnAttuale=d.spesaAnn!=null ? d.spesaAnn : parseFloat((spesaPer*fattore).toFixed(2));
  const costoAnn=parseFloat((costoPer*fattore).toFixed(2));

  const rispPer=parseFloat((spesaPer-costoPer).toFixed(2));
  const rispAnn=parseFloat((spesaAnnAttuale-costoAnn).toFixed(2));
  const percPer=parseFloat((rispPer/spesaPer*100).toFixed(1));
  const percAnn=parseFloat((rispAnn/spesaAnnAttuale*100).toFixed(1));
  const isSav=rispPer>=0;

  const qfBadge=d.qfAnn?'<span class="br">‚úì da bolletta</span>':'<span class="bs">stima</span>';
  const indN=t==='l'?'PUN GME':'PSV';
  const consumoAnnStima=(d.consumoAnn!=null?d.consumoAnn:consumoPer*fattore).toFixed(0);

  document.getElementById('R'+U(t)).innerHTML=`
    <div class="chips">
      <div class="chip"><b>${consumoPer.toFixed(0)}</b>${ua} nel periodo</div>
      <div class="chip"><b>${consumoAnnStima}</b>${ua}/anno (stima)</div>
      <div class="chip"><b>${d.op}</b>operatore att.</div>
      <div class="chip"><b>${mesi}</b>mes${mesi===1?'e':'i'} fatturazione</div>
      <div class="chip">${d.qfAnn?`Canone attuale: ‚Ç¨ ${d.qfAnn.toFixed(2)}/anno ${qfBadge}`:'Canone attuale non disponibile'}</div>
    </div>
  `;
  document.getElementById('R'+U(t)).style.display='block';
}

function showEr(m){const e=document.getElementById('mEr');e.textContent=m;e.style.display='block';setTimeout(()=>e.style.display='none',8000);}
function showOk(m){const e=document.getElementById('mOk');e.textContent=m;e.style.display='block';setTimeout(()=>e.style.display='none',8000);}
</script>
</body>
</html>
